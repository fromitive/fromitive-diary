---
title: "요구사항 분석에 객체지향을 적용해보자"
description: "좀 더 가독성 있고 구조를 볼 수 있는 구성"
time: 2023-11-28 16:02:02
tags:
  - object
  - software-engineering
  - java
---


## 지난글에 이어서

지난글에서는 다음과 같이 specification으로 분리해보았다. 이렇게 리스트 형태로 분리하다보면 무엇을 만들어야할지 한눈에 보이지 않는다. 객체지향 프로그래밍은 이를 보기 쉽게 변경이 가능하도록 도와준다. 보기 쉽게 변경이 가능하다는 말은 어떤 것을 개발해야 할지 한 눈에 보이게 만든다는 말과 동일하다고 생각한다. 그리고 직관적이다. 객체 사이의 관계를 명확하게 보여주기 때문이다.

``` title="오브젝트에서 설명하는 영화 예매 시스템"
1. 예매자는 특정한 조건을 만족하면 요금을 할인받을 수 있다. 
2. 할인액을 결정하는 `할인 조건` 및 `할인 정책` 이라는 두 가지 규칙이 존재한다. 
3. `할인 조건`은 가격의 할인 여부를 결정하며 `순서 조건`과 `기간 조건`의 두가지로 나눌 수 있다.
4. `순서 조건`은 상영 순번을 이용해 할인 여부를 결정하는 규칙이다
5. **(숨겨진 Specification)** 상영에는 순번(number)이 있다.
6. `기간 조건`은 영화 상영 시작 시간을 이용해 할인 여부를 결정한다. `기간 조건`은 요일, 시작 시간, 종료 시간의 세 부분으로 구성되며 영화 시작 시간이 해당 기간 안에 포함될 경우 요금을 할인한다.
7. **(숨겨진 Specification)** 상영에는 시작 시간이 있다.
8. `할인 정책`은 할인 요금을 결정한다. 할인 정책에는 `금액 할인 정책`과 `비율 할인 정책`이 있다.
9. `금액 할인 정책`은 예매 요금에서 일정 금액을 할인해주는 방식이다.
10. `비율 할인 정책`은 정가에서 일정 비율의 요금을 할인해 주는 방식이다.
11. **영화별로 하나의 할인 정책만 할당할 수 있다** 할인 정책을 지정하지 않는 것도 가능하다.
12. 할인 조건은 다수의 할인 조건을 함께 지정할 수 있다. 순서 조건과 기간 조건을 섞을 수도 있다.
13. 할인을 적용하기 위해서는 할인 조건과 할인 정책을 함께 조합해서 사용한다.
14. 사용자의 예매 정보가 할인 조건 중 하나라도 만족하는지 검사한다.
15. 할인 조건을 만족할 경우 할인 정책을 이용해 하인 요금을 계산한다.
16. 할인 정책은 적용돼 있지만 할인 조건을 만족하지 모사는 경우나 할인 정책이 적용되어 있지 않은 경우에는 할인하지 않는다.
17. **(숨겨진 Specification)** 예매를 하는 사용자는 2명 이상 예매할  수 있다.
18. **(숨겨진 Specification)** `금액`은 할인하기 위해 더하기, 곱하기(비율 할인 정책), 빼기(금액 할인 정책)를 할 수 있어야 한다.
```

## 객체로 나누어 보기

specification을 객체로 나누면 아래와 같게 나온다.

```
1. 상영
2. 영화
3. 고객
4. 할인 정책
    1) 금액 할인 정책
    2) 비율 할일 정책
5. 할인 조건
    1) 기간 조건
    2) 순서 조건
6. 예매
7. 돈
```

`7. 돈`은 요구사항에 바로 나타나진 않았지만, 예매를 하기 위해서는 금액이 필요하고, 할인의 대상도 돈이기 때문에 돈도 마찬가지로 필요에 따라 객체화 해야 한다. 공부하면서 느낀건 객체로 만들 필요한 것들을 가능한 객체로 만드는 것이 좋다고 생각한다.

이제 나누어진 객체에 따라 필요한 요구사항 및 성질을 을 상세히 작성해보자

### 1. 상영

상영은 일정한 시간에 영화를 보여주는 역할을 한다. 상영에는 순번이 있으며 각 순번마다 시작 시간이 다르다. 시작 시간은 `기간 할인 조건`과 `예매`객체를 사용하기 위해 정확한 시간이 필요하다 (년 월 일 시 분) 마지막으로 어떤 영화를 보여줄 것인가인 `영화`객체를 담는다.

- [ ] 상영 객체의 구성요소
    - [ ] 순번
    - [ ] 시작 시간은 정확한 시간이 필요함 (년 월 일 시 분) (`기간 할인 조건`, `예매`)
    - [ ] 상영할 `영화` 정보

상영 객체는 어떤 걸 할 수 있을까? 객체지향을 프로그래밍을 잘하려면 <<오브젝트>> 책에서 나와있듯이 프로그램을 객체의 자율적 협력으로 봐야한다고 설명한다. 이는 즉, 객체가 무엇을 가지고 있는지를 먼저 만들고 전체적으로 만들고 필요에 따라 method를 생성하라는 말처럼 들린다. 일단 그렇게 해보자. 메소드를 가지고 있지 않은 `Screeen` 객체를 생성해보자.

``` java title="Screen.java"
class Screen {
    int sequence;
    LocalDateTime startDateTime;
    Movie movie;
}

```
### 2. 영화

영화는 영화 금액과, 제목이 들어간다. 특이한건, 요구사항 11번에 따라 영화와 할인 정책은 1:1 관계를 띄운다. 즉, 1개의 영화는 다른 정책을 적용할 수 없다. 이를 바탕으로 영화 객체를 만들어보자.

``` java title="Movie.java"
class Movie {
    Money fee;
    String name;
    DiscountPolicy discountPolicy;
}
```

### 3. 고객

고객은 영화를 예매하기 위한 객체이다. 책의 상세 요구사항에 나타나있지 않지만, 요금은 개인 또는 단체에 따라 차이가 날 것이다. 또한, 현재 가지고 있는 금액보다 예매 요금이 높다면 예매를 할 수 없을 것이다. 이를 바탕으로 고객 객체를 만들어 보자.

``` java title="Customer.java"
class Customer {
    int audiences;
    Money amount;
}
```

### 4. 할인 정책

요금 할인에 대한 정책이다. 13번의 요구사항에 따라 다수의 할인 조건 중 하나라도 일치하면 할인이 적용되도록 해야 한다. 이를 위해 할인 조건들을 가지고 있어야 한다.

할인 정책은 금액 할인 정책, 비율 할인 정책이 있다. 금액 할인 정책과 비율 할인 정책은 할인의 성격이 다르기 때문에, 별도로 생성하는 것이 유리하다.

``` java title="DiscountPolicy.java"
class DiscountPolicy {
    List<DiscountCondition> conditions;
}

class AmountDiscountPolicy extends DiscountPolicy{
    Money discountAmount;
}

class PeriodDiscountPolicy extends DiscountPolicy{
    Period discountPeriod;
}
```

### 5. 할인 조건

할인 조건을 검사하기 위한 객체이다. 맴버가 없는 것이 특징이다. 어떤 변수를 받을지 예측하지 못하지만, 확실한 건 4번 6번 요구사항에 따라 상영 데이터를 받는 것이 유리할 것이다. 처음으로 맴버가 있지 않고, 다른 객체의 관계를 통해 메소드를 생성하였다. 할인 조건은 조건이 맞는지 검사한 후 할인을 받을 수 있는지에 대한 여부를 검사해야 하므로 아래와 같이 작성되어야 한다.

``` java title="DiscountCondition.java"
interface DiscountCondition {
    boolean isSatisfiedBy(Screen screen); //요구사항에 따라 필요한 메소드
}
```

### 6. 예매

드디어 예매가 나왔다. 예매에 대해 상세 요구사항이 없지만, 예매를 구분하기 위해 고객과 상영 정보를 받으면 되지 않을까? 생각한다. 적어도 누가 어떤 상영관을 예약했는지 알 수 있으니까?

``` java title="Reservation.java"
class Reservation {
    Customer customer;
    Screen screen;
}
```

### 7. 돈

마지막으로 숨겨진 요구사항인 돈이다. 돈을 생성해야 하는 이유는 다음과 같으며 예매 시스템을 만들고 각 객체와 상호작용을 위해 나온 객체이므로 숨겨저 보였다고 생각한다. 

``` title="돈 객체의 생성 근거"
7. 돈
아래의 정책을 적용하기 위해 필요
    할인 정책은 금핵 할인 정책, 비율 할인 정책이 있다.
    금액 할인 정책은 예매 요금에서 일정 금액을 할인해주는 방식이다.
    비율 할인 정책은 일정 비율의 요금을 할인해 주는 방식이다.
영화의 금액을 결정하는데 필요

돈은 숫자이고 수를 다루는 기본 자료형의 통일성을 위해 필요
```

돈은 숫자이므로 숫자에 대한 자료형 하나 받자. java에서 제공되는 `BigDecimal`은 큰 숫자 및 소숫점까지 정확하게 계산해주는 자료형이다. 이를 통해 돈 객체를 만들어 보자.

``` java title="Money.java"
class Money {
    BigDecimal amount;
}
```

## 결론 : 요구사항에 따라 객체와 객체의 행위가 달라진다.

지금까지 각 요구사항을 객체로 나누는 작업을 했다. 위의 예제를 알 수 있듯이 각 단일 객체는 여러 객체로 구성될 수 있고 그렇지 못할 경우도 있다. 메소드를 작성하지 않았는데 그 이유는 **요구사항에 따라 객체의 행위가 달라지기 때문이다.** 요구사항이 살아있지 않을 경우에는 작성하는 것이 유리하겠지만. 현실은 그렇지 않다. 변하지 않는 것은 변하는 사실밖에 없기 때문에 요구사항은 달라진다.

따라서 객체의 메소드는 사라지기도 하고, 생성되거나 변경되기도 한다고 생각한다. 이를 유연하게 대처하기 위해선 <<오브젝트>>에서 말한 것 처럼 객체는 서로 협력함을 전제하에 메소드를 작성해야 한다. 예매와 상영의 관계 상영과 영화의 관계, 상영과 돈의 관계, 할인 정책과 영화의 관계 할인 정책과 상영과의 관계.. 등 객체의 개수가 많아지게 되면 각 객체의 관계는 복잡해진다.

이런 복잡함을 통제하기 위해 요구사항에 맞춰 객체와의 관계를 조절하고, 의존적이지 않도록 설계하는 것이 객체지향 설계의 목표라고 생각한다.

객체와의 관계를 적절히 설계하여 유연하게 대처할 수 있도록 작성해보자.